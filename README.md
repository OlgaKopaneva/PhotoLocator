# Проект_Команда №12. 
# «PhotoLocator: Ваш путеводитель по миру на кончиках пальцев»

---
## Оглавление[](#оглавление)
[1. Описание проекта](#описание-проекта)

[2. Какой кейс решаем](#какой-кейс-решаем)

[3. Краткая информация о данных](#краткая-информация-о-данных)

[4. Этапы работы над проектом](#этапы-работы-над-проектом)

[5. Результат](#результат)

[6. Планы развития проекта](#планы-развития-проекта)

---

### Описание проекта[](#описание-проекта)
Проект «PhotoLocator» нацелен на решение двух задач, с которыми сталкивается каждый путешественник:
- быстро понять, что за объект я вижу (как называется, какова его история, стоит ли зайти внутрь)
- вспомнить достопримечательность на фотографии из отпуска в «один клик».

***Сайт (презентация) проекта:*** https://arsalexeev.ru/photolocator#nav 

:arrow_up: [к оглавлению](#оглавление)

---

### Какой кейс решаем[](#какой-кейс-решаем)

**В бизнес-терминах:**  
Нужно запустить сервис, который при помощи ML-моделей по фотографии пользователя выдает в чат-боте описание достопримечательности и рекомендации к ней. 

**Техническая постановка:**  
*На первом этапе* - решить задачу детектирования и распознавания достопримечательности на фото-изображении, поданном на вход пользователем, путем дообучения предобученной модели нейросети.  
*На втором этапе* – полученный ответ первого этапа посредством подключения к API LLM-модели подавать в качестве промпта LLM-модели; ответ модели выводить пользователю в чат-боте Telegram. 

**Метрика качества:**  
Accuracy модели распознавания >90%

**Пример результата работы сервиса:**
<p align="left">
  <img width="350" height="380" src="images\chat-bot.jpg">
</p>  

:arrow_up: [к оглавлению](#оглавление)

---

### Краткая информация о данных[](#краткая-информация-о-данных)
Модель дообучена на данных датасета «The Oxford Buildings Dataset» (Oxford5k), содержащем фотографии 11 достопримечательностей Оксфордского университета *(здания колледжей: “All souls”, “Hertford”, “Keble”, “Magdalen”, “Balliol”, “Christ Church”, а также “Pitt Rivers Museum”, “Bodleian Libraries”, “Ashmolean Museum”, “Radcliffe Camera”, “Cornmarket Street”)*.  
По каждому объекту присутствуют фотографии разного качества (ok, good, junk and query). Суммарно 5063 изображений.

Ссылка на датасет: https://www.kaggle.com/datasets/vadimshabashov/oxford5k 

:arrow_up: [к оглавлению](#оглавление)

---

### Этапы работы над проектом[](#этапы-работы-над-проектом)

**Выбор модели:**  
За основу была взята модель ResNet50 (и ее pretrained веса - ResNet50_Weights, полученные на датасете ImageNet, содержащем более 1 млн. изображений и 1000 классов). ResNet50 основана на архитектуре «остаточных» сверточных нейронных сетей (Residual CNN), содержит 50 слоев. Выбор обусловлен высокими показателями модели для классификации изображений (Accuracy базовой модели – 95.4%) и частотой ее использования для решения аналогичных задач.

**Дообучение модели:**  
Модель дообучена на данных датасета «The Oxford Buildings Dataset» (описан выше) и в итоге содержит 11 классов. В рамках доработки модели (релиз от 26.12.2023) улучшили процесс дообучения: изменили способ подготовки данных (разметка оригинального датасета была не полной) и разблокировали сv1 layer, что позволило получить точность выше на данных с "мусором" (junk).

*Функция потерь*: PyTorch CrossEntropyLoss  
*Оптимизатор*: Адаптивная оценка момента (Adam)  
*Число эпох*: 5

**Чат-бот с использованием ответов ChatGPT:**  
Запущен чат-бот, получающий описание для класса, определенного моделью на предыдущем шаге. Используемая библиотека - GPT4free (g4f). Подаваемый промпт для ответа: *«Ты гид по колледжам в Оксфорде, подробно рассказывающий о их истории и культуре, делая это увлекательно и информативно. Подробно расскажи о месте под названием {predicted_class}. Обязательно на русском»*


:arrow_up: [к оглавлению](#оглавление)

---

### Результат[](#результат)

**Показатели качества итоговой модели:**  
Эпоха 5/5  
Обучение - Loss: 0.1626, Accuracy: 0.9686  
Валидация - Loss: 0.1770, Accuracy: 0.9504
<p align="left">
  <img width="700" height="300" src="images\output_2_1.png">
</p> 
<p align="left">
  <img width="300" height="250" src="images\output_2_2.png">
</p>  
<p align="left">
  <img width="700" height="250" src="images\output_2_3.png">
</p> 
 
**Инструкция по установке и использованию:**
1. Установить библиотеки (версии библиотек) в соответствии со списом, отраженным в файле requarements.txt (обращаем внимание, что pytorch нужно устанавливать с поддержкой cuda)
2. Скачать файлы проекта, в частности:  
    2.1. в файле ```classification_resnet_cv1.ipynb``` приведено обучение обновленной версии модели (в файле ```classification_resnet.ipynb``` - обучение первой версии модели) (можно видеть настройки и результаты обучения)    
    2.2. в релизах проекта также размещен файл ```classification_with_cv1_junk.pth```, в котором находится обученная (в соответствии с п. 2.1) модель  (```classification_resnet.pth``` для первой версии)  
    2.3. файл ```prediction.py``` отвечает за предсказание класса поданного на вход элемента по модели из п.2.2  
    2.4. файлы ```async_gpt.py``` и ```tg_bot.py``` - файлы настройки чат-бота в Telegram  
3. Для просмотра работы чат-бота запусть бота по ссылке: [PhotoLocator Bot](https://t.me/OxfordExplorerBot) (боту на распознание нужно отправить фото одной из 11 достопримечательностей Оксфорда - перечислены выше)  

:arrow_up: [к оглавлению](#оглавление)

---

### Планы развития проекта[](#планы-развития-проекта)
При наличии больших вычислительных мощностей и времени возможно было бы построить модель для полного списка мировых достопримечательностей, взяв за основу датасет Google Landmarks Dataset v2 (основан на более 5 млн. изображений достопримечательностей). Также рассматриваются варианты реализации проекта на базе иных архитектур.

**Команда проекта:**
- Казиев Владислав
- Гришин Егор
- Алексеев Арсалан
- Копанева Ольга
- Лапенков Егор

 


:arrow_up: [к оглавлению](#оглавление)
